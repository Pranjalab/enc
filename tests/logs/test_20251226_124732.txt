========================================
RUNNING ADMIN TEST SUITE
========================================
=== Starting Admin Login Test ===
1. Initializing ENC (Local Config)...
╭────────────────────────────────── ENC Init ──────────────────────────────────╮
│ Welcome to ENC Configuration Wizard                                          │
╰──────────────────────────────────────────────────────────────────────────────╯
Initialize Global (~/.enc) or Local (./.enc) config? [global/local] (global): Initializing LOCAL configuration in 
/Users/pranjalbhaskare/projects/enc/tests/admin_user/.enc
Enter ENC Server URL (http://localhost:2222): Enter Username: Enter SSH Key Path (): Configuration initialized at 
/Users/pranjalbhaskare/projects/enc/tests/admin_user/.enc/config.json
Run 'enc check-connection' to verify.
2. Logging in...
Authenticating as admin...
Login Success! Session ID: 5f2fbf15-ee51-4bef-938e-17e1147f4774
3. Showing Config...
                    ENC Configuration                     
┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Key             ┃ Value                                ┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ url             │ http://localhost:2222                │
│ username        │ admin                                │
│ ssh_key         │ /Users/pranjalbhaskare/.ssh/enc_key  │
│ session_id      │ 5f2fbf15-ee51-4bef-938e-17e1147f4774 │
│ active_projects │ None                                 │
└─────────────────┴──────────────────────────────────────┘
4. Listing Projects...
                                    Your Projects                                     
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃ Project Name ┃ Local Mount ┃ Server Mount                             ┃ Exec Point ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ test_project │             │ /home/admin/.enc/run/master/test_project │            │
└──────────────┴─────────────┴──────────────────────────────────────────┴────────────┘
5. Creating Project Test Directory...
6. Initializing Project 'test_project'...
Project 'test_project' already exists in your account.
Do you want to re-initialize it? [y/N]: Initializing project 'test_project' in 
'/Users/pranjalbhaskare/projects/enc/tests/admin_user/project_test'...
Backing up existing files to 
/Users/pranjalbhaskare/projects/enc/tests/admin_user/.enc/backups/test_project_t
emp...
Server Error: Project 'test_project' already exists on the server.
7. Checking Project List (Mounted)...
                                    Your Projects                                     
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃ Project Name ┃ Local Mount ┃ Server Mount                             ┃ Exec Point ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ test_project │             │ /home/admin/.enc/run/master/test_project │            │
└──────────────┴─────────────┴──────────────────────────────────────────┴────────────┘
8. Unmounting...
Unmounting project 'test_project'...
Project 'test_project' is not currently active.
9. Mounting Again...
Mounting project 'test_project' to '/Users/pranjalbhaskare/projects/enc/tests/admin_user/project_test'...
Successfully mounted project test_project.
Project mounted and bridged.
10. Logout...
Unmounted /Users/pranjalbhaskare/projects/enc/tests/admin_user/project_test.
Remote project 'test_project' unmounted.
Logged out successfully. Local sessions cleared.
11. Login again and List Users...
Authenticating as admin...
Login Success! Session ID: d944cac5-6b17-4854-9a2a-68a2a2c9bf14
     ENC Users      
┏━━━━━━━━━━┳━━━━━━━┓
┃ Username ┃ Role  ┃
┡━━━━━━━━━━╇━━━━━━━┩
│ admin    │ admin │
│ dev_user │ user  │
└──────────┴───────┘
12. Creating Developer User...
Path to public SSH key (optional, press Enter to skip): Creating user dev_user with role user...
Server Error: User dev_user already exists.
{"status": "error", "message": "Failed to create user"}
 
Failed to create user.
=== Admin Test Complete ===

========================================
RUNNING DEV USER TEST SUITE
========================================
=== Starting Dev User Test ===
1. Initializing ENC (Local Config)...
╭────────────────────────────────── ENC Init ──────────────────────────────────╮
│ Welcome to ENC Configuration Wizard                                          │
╰──────────────────────────────────────────────────────────────────────────────╯
Initialize Global (~/.enc) or Local (./.enc) config? [global/local] (global): Initializing LOCAL configuration in 
/Users/pranjalbhaskare/projects/enc/tests/dev_user/.enc
Enter ENC Server URL (http://localhost:2222): Enter Username: Enter SSH Key Path (): Configuration initialized at 
/Users/pranjalbhaskare/projects/enc/tests/dev_user/.enc/config.json
Run 'enc check-connection' to verify.
2. Logging in...
Authenticating as dev_user...
Login Success! Session ID: 40a675f5-0417-45bf-ba58-d09bf3a174e3
3. Showing Config...
                    ENC Configuration                     
┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Key             ┃ Value                                ┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ url             │ http://localhost:2222                │
│ username        │ dev_user                             │
│ ssh_key         │                                      │
│ session_id      │ 40a675f5-0417-45bf-ba58-d09bf3a174e3 │
│ active_projects │ None                                 │
└─────────────────┴──────────────────────────────────────┘
4. Setting up SSH Key...
Generating new SSH key pair in /Users/pranjalbhaskare/projects/enc/tests/dev_user/.enc/.ssh...
SSH key pair generated.
Sending public key to ENC Server...
Success! Server accepted your key.
Local configuration updated to use: /Users/pranjalbhaskare/projects/enc/tests/dev_user/.enc/.ssh/enc_id_rsa
5. Creating Dev Project...
6. Initializing Project 'test_project' (Dev Context)...
Project 'test_project' already exists in your account.
Do you want to re-initialize it? [y/N]: Initializing project 'test_project' in 
'/Users/pranjalbhaskare/projects/enc/tests/dev_user/dev_project_test'...
Backing up existing files to 
/Users/pranjalbhaskare/projects/enc/tests/dev_user/.enc/backups/test_project_tem
p...
Server Error: Project 'test_project' already exists on the server.
7. Checking Project List...
                                      Your Projects                                      
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃ Project Name ┃ Local Mount ┃ Server Mount                                ┃ Exec Point ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ test_project │             │ /home/dev_user/.enc/run/master/test_project │            │
└──────────────┴─────────────┴─────────────────────────────────────────────┴────────────┘
8. Unmounting...
Unmounting project 'test_project'...
Project 'test_project' is not currently active.
9. Mounting...
Mounting project 'test_project' to '/Users/pranjalbhaskare/projects/enc/tests/dev_user/dev_project_test'...
Successfully mounted project test_project.
Project mounted and bridged.
10. Verification: Access Check...
Permission Denied: You are not allowed to list users.
SUCCESS: Dev user denied user list access (Permission Denied expected).
11. Logout...
Unmounted /Users/pranjalbhaskare/projects/enc/tests/dev_user/dev_project_test.
Remote project 'test_project' unmounted.
Logged out successfully. Local sessions cleared.
=== Dev User Test Complete ===

✅ ALL TESTS PASSED
